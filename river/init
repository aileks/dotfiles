#!/bin/sh

export PATH="$HOME/.local/bin:$HOME/.cargo/bin:$HOME/.bun/bin:$PATH"
export XDG_CURRENT_DESKTOP="river"
export XCURSOR_SIZE=32
export GTK_CSD=0
export TERMINAL=wezterm
export EDITOR="emacsclient -t"
export VISUAL="emacsclient -t -nw"
export SUDO_EDITOR=vim
export MANPAGER="bat -plman"
export SSH_AUTH_SOCK="$HOME/.1password/agent.sock"
export GPG_TTY="$(tty)"

wlr-randr --output DP-1 --on --mode 2560x1440@200Hz --scale 1.25
wlr-randr --output HDMI-A-1 --on --mode 3840x2160@60Hz --scale 2 --transform 90 --left-of DP-1

mod="Mod4"

riverctl map normal "$mod" Q close
riverctl map normal "$mod+Shift" Q exit

riverctl map normal "$mod" Return spawn "wezterm"
riverctl map normal "$mod" D spawn "fuzzel"
riverctl map normal "$mod" E spawn "thunar"
riverctl map normal "$mod" W spawn "helium-browser"
riverctl map normal "$mod" X spawn "swaylock"
riverctl map normal "$mod+Shift" P spawn "$HOME/.local/bin/power-menu"
riverctl map normal "$mod" S spawn "signal-desktop"
riverctl map normal "$mod" B spawn "emacsclient -c -a ''"

riverctl map normal "$mod" J focus-view next
riverctl map normal "$mod" K focus-view previous
riverctl map normal "$mod+Shift" J swap next
riverctl map normal "$mod+Shift" K swap previous
riverctl map normal "$mod+Shift" Return zoom

riverctl map normal "$mod" Comma focus-output previous
riverctl map normal "$mod" Period focus-output next
riverctl map normal "$mod+Shift" Comma send-to-output -current-tags previous
riverctl map normal "$mod+Shift" Period send-to-output -current-tags next

riverctl map normal "$mod" H send-layout-cmd rivertile "main-ratio -0.05"
riverctl map normal "$mod" L send-layout-cmd rivertile "main-ratio +0.05"
riverctl map normal "$mod+Shift" H send-layout-cmd rivertile "main-count +1"
riverctl map normal "$mod+Shift" L send-layout-cmd rivertile "main-count -1"

riverctl map normal "$mod" Space toggle-float
riverctl map normal "$mod" F toggle-fullscreen
riverctl map normal "$mod" Tab focus-previous-tags

riverctl map normal "$mod" Up send-layout-cmd rivertile "main-location top"
riverctl map normal "$mod" Right send-layout-cmd rivertile "main-location right"
riverctl map normal "$mod" Down send-layout-cmd rivertile "main-location bottom"
riverctl map normal "$mod" Left send-layout-cmd rivertile "main-location left"
riverctl map normal "$mod" BracketLeft spawn "$HOME/.local/bin/layout-cycle prev"
riverctl map normal "$mod" BracketRight spawn "$HOME/.local/bin/layout-cycle next"

riverctl map normal "$mod+Alt" H move left 100
riverctl map normal "$mod+Alt" J move down 100
riverctl map normal "$mod+Alt" K move up 100
riverctl map normal "$mod+Alt" L move right 100

riverctl map normal "$mod+Alt+Control" H snap left
riverctl map normal "$mod+Alt+Control" J snap down
riverctl map normal "$mod+Alt+Control" K snap up
riverctl map normal "$mod+Alt+Control" L snap right

riverctl map normal "$mod+Alt+Shift" H resize horizontal -100
riverctl map normal "$mod+Alt+Shift" J resize vertical 100
riverctl map normal "$mod+Alt+Shift" K resize vertical -100
riverctl map normal "$mod+Alt+Shift" L resize horizontal 100

riverctl map-pointer normal "$mod" BTN_LEFT move-view
riverctl map-pointer normal "$mod" BTN_RIGHT resize-view
riverctl map-pointer normal "$mod" BTN_MIDDLE toggle-float

for i in $(seq 1 9); do
  tags=$((1 << ($i - 1)))
  riverctl map normal "$mod" $i set-focused-tags $tags
  riverctl map normal "$mod+Shift" $i set-view-tags $tags
  riverctl map normal "$mod+Control" $i toggle-focused-tags $tags
  riverctl map normal "$mod+Shift+Control" $i toggle-view-tags $tags
done

all_tags=$(((1 << 32) - 1))
riverctl map normal "$mod" 0 set-focused-tags $all_tags
riverctl map normal "$mod+Shift" 0 set-view-tags $all_tags

riverctl map normal None Print spawn "$HOME/.local/bin/screenshot area clipboard"
riverctl map normal Shift Print spawn "$HOME/.local/bin/screenshot area file"
riverctl map normal Control Print spawn "$HOME/.local/bin/screenshot window clipboard"
riverctl map normal Control+Shift Print spawn "$HOME/.local/bin/screenshot window file"
riverctl map normal "$mod" Print spawn "$HOME/.local/bin/screenshot fullscreen clipboard"
riverctl map normal "$mod+Shift" Print spawn "$HOME/.local/bin/screenshot fullscreen file"

riverctl map normal None F9 spawn "$HOME/.local/bin/screenrecord area"
riverctl map normal Shift F9 spawn "$HOME/.local/bin/screenrecord window"
riverctl map normal Control F9 spawn "$HOME/.local/bin/screenrecord fullscreen"

for mode in normal locked; do
  riverctl map $mode None XF86AudioRaiseVolume spawn "pamixer -i 5; pkill -RTMIN+5 waybar"
  riverctl map $mode None XF86AudioLowerVolume spawn "pamixer -d 5; pkill -RTMIN+5 waybar"
  riverctl map $mode None XF86AudioMute spawn "pamixer --toggle-mute; pkill -RTMIN+5 waybar"
  riverctl map $mode None XF86AudioMedia spawn "playerctl play-pause"
  riverctl map $mode None XF86AudioPlay spawn "playerctl play-pause"
  riverctl map $mode None XF86AudioPrev spawn "playerctl previous"
  riverctl map $mode None XF86AudioNext spawn "playerctl next"
done

riverctl background-color 0x121212
riverctl border-color-focused 0xb14242
riverctl border-color-unfocused 0x535353
riverctl border-color-urgent 0xdf6464
riverctl border-width 2

riverctl set-repeat 50 300
riverctl focus-follows-cursor normal

riverctl input "*" accel-profile flat
riverctl input "*" pointer-accel 0

riverctl rule-add -app-id "calendar-floating" float
riverctl rule-add -app-id "btop-floating" float
riverctl rule-add -app-id "volume-floating" float
riverctl rule-add -app-id "*" ssd

riverctl default-layout rivertile
rivertile -view-padding 3 -outer-padding 3 -main-ratio 0.5 -main-count 1 &

pkill -x swaybg 2>/dev/null || true
swaybg -o DP-1 -i "$HOME/Pictures/wallpaper.jpg" -m fill &
swaybg -o HDMI-A-1 -i "$HOME/Pictures/wallpaper2.jpg" -m fill &

pkill -x waybar 2>/dev/null || true
waybar &

pkill -x mako 2>/dev/null || true
mako &

pkill -x swayidle 2>/dev/null || true
swayidle -w &

/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
blueman-applet &
solaar &
emacs --daemon &
