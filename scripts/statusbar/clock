#!/bin/bash
# Statusbar module: clock/date
# Left click: toggle between time/date
# Right click: launch calcurse

state_file="/tmp/dwmblocks_clock_state"

if [ ! -f "$state_file" ]; then
  echo "time" >"$state_file"
fi

case $BUTTON in
1)
  current_state=$(cat "$state_file")
  if [ "$current_state" = "time" ]; then
    echo "date" >"$state_file"
  else
    echo "time" >"$state_file"
  fi
  pkill -RTMIN+1 dwmblocks
  current_state=$(cat "$state_file")
  ;;
3)
  wezterm start --class calendar-floating -- calcurse >/dev/null 2>&1 &
  disown $!
  ;;
esac

icon="ó°ƒ°"
date_fmt="%a %b %d"
time_fmt="%H:%M"

date_str=$(date +"$date_fmt")
time_str=$(date +"$time_fmt")

current_state=$(cat "$state_file")

if [ "$current_state" = "time" ]; then
  # Show only time
  printf "^c#e49a44^%s^d^ %s" "$icon" "$time_str"
else
  # Show only date
  printf "^c#e49a44^%s^d^ %s" "$icon" "$date_str"
fi
