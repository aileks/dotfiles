#!/bin/bash
# Statusbar module: volume control
# Left click: toggle mute
# Right click: open wiremix

set -euo pipefail

case "${1:-}" in
  --toggle-mute)
    pamixer -t
    pkill -RTMIN+5 waybar
    exit 0
    ;;
  --open)
    wezterm start --class volume-floating -- wiremix >/dev/null 2>&1 &
    disown $!
    exit 0
    ;;
  --inc)
    pamixer -i 5
    pkill -RTMIN+5 waybar
    exit 0
    ;;
  --dec)
    pamixer -d 5
    pkill -RTMIN+5 waybar
    exit 0
    ;;
esac

vol=$(pamixer --get-volume 2>/dev/null || true)
muted=$(pamixer --get-mute 2>/dev/null || true)

if [[ $muted == "true" ]]; then
  printf '{"text":"󰝟","class":"volume muted"}\n'
  exit 0
fi

icon="󰕿"
class="normal"

if [[ -z $vol ]]; then
  vol=0
fi

if [[ $vol -eq 0 ]]; then
  icon="󰕿"
  class="muted"
elif [[ $vol -lt 30 ]]; then
  icon="󰕿"
  class="normal"
elif [[ $vol -lt 70 ]]; then
  icon="󰖀"
  class="normal"
else
  icon="󰕾"
  class="high"
fi

printf '{"text":"%s %s%%","class":"volume %s"}\n' "$icon" "$vol" "$class"
