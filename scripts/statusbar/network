#!/bin/bash
# Statusbar module: network status
# Left click: open network connections
# Right click: toggle wifi
# Middle click: show network details notification

case $BUTTON in
1)
	nm-connection-editor
	disown $!
	;;
2)
	connection=$(nmcli -t -f NAME,TYPE connection show --active 2>/dev/null | grep -E 'wifi|ethernet' | head -1 | cut -d: -f1)
	if [ -n "$connection" ]; then
		notify-send "󰈀 Network" "Connected: $connection"
	else
		notify-send "󰤭 Network" "No active connection"
	fi
	;;
3)
	if nmcli -t -f wifi radio | grep -q "enabled"; then
		nmcli radio wifi off
		notify-send "󰤭 WiFi Disabled"
	else
		nmcli radio wifi on
		notify-send "󰤨 WiFi Enabled"
	fi
	pkill -RTMIN+4 dwmblocks
	;;
esac

connection=$(nmcli -t -f NAME,TYPE connection show --active 2>/dev/null | grep -E 'wifi|ethernet' | head -1 | cut -d: -f1)

if [ -z "$connection" ]; then
	icon="󰤭"
	color="#535353"
	printf "^c%s^%s^d^" "$color" "$icon"
	exit 0
fi

type=$(nmcli -t -f NAME,TYPE connection show --active 2>/dev/null | grep -E 'wifi|ethernet' | head -1 | cut -d: -f2)

if [ "$type" = "802-11-wireless" ]; then
	label="WiFi"
	signal=$(nmcli -t -f IN-USE,SIGNAL dev wifi 2>/dev/null | grep '^\*' | cut -d: -f2)
	if [ -n "$signal" ] && [ "$signal" -ge 70 ]; then
		icon="󰤨"
		color="#4a8b8b"
	elif [ -n "$signal" ] && [ "$signal" -ge 40 ]; then
		icon="󰤥"
		color="#a7a7a7"
	else
		icon="󰤟"
		color="#e49a44"
	fi
else
	label="Eth"
	icon="󰈀"
	color="#4a8b8b"
fi

printf "^c%s^%s %s^d^" "$color" "$icon" "$label"
