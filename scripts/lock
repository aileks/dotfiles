#!/bin/bash

set -euo pipefail

INIT_COLOR="0x121212"
INPUT_COLOR="0xd87c4a"
INPUT_ALT_COLOR="0xe49a44"
FAIL_COLOR="0xc53030"

args=()
swaylock_args=()
if [[ ${1:-} == "--fork" ]]; then
  swaylock_args+=("-f")
  args+=("-fork-on-lock")
  shift
fi

if command -v swaylock >/dev/null 2>&1; then
  exec swaylock \
    "${swaylock_args[@]}" \
    --color "121212" \
    --inside-color "121212" \
    --ring-color "d87c4a" \
    --ring-ver-color "e49a44" \
    --ring-wrong-color "c53030" \
    --key-hl-color "e49a44" \
    --text-color "d5d5d5"
fi

if command -v waylock >/dev/null 2>&1; then
  exec waylock \
    "${args[@]}" \
    -init-color "$INIT_COLOR" \
    -input-color "$INPUT_COLOR" \
    -input-alt-color "$INPUT_ALT_COLOR" \
    -fail-color "$FAIL_COLOR"
fi

if command -v loginctl >/dev/null 2>&1; then
  if [[ -n ${XDG_SESSION_ID:-} ]]; then
    exec loginctl lock-session "$XDG_SESSION_ID"
  fi
  exec loginctl lock-sessions
fi

printf '%s\n' "No lock backend found" >&2
exit 1
