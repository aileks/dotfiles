#!/usr/bin/env bash

source "$CONFIG_DIR/colors.sh"

PLUGIN_DIR="$CONFIG_DIR/plugins"

sketchybar --bar height=32 \
                 position=top \
                 sticky=off \
                 padding_left=10 \
                 padding_right=10 \
                 color=$BAR_COLOR \
                 border_color=$BAR_BORDER_COLOR \
                 border_width=1 \
                 corner_radius=9 \
                 blur_radius=30 \
                 margin=8 \
                 shadow=off \
                 y_offset=3

default=(
    padding_left=5
    padding_right=5
    icon.font="BerkeleyMono Nerd Font:Bold:16.0"
    label.font="BerkeleyMono Nerd Font:Medium:14.0"
    icon.color=$ICON_COLOR
    label.color=$LABEL_COLOR
    icon.padding_left=4
    icon.padding_right=4
    label.padding_left=4
    label.padding_right=4
    background.corner_radius=6
    background.height=24
)

sketchybar --default "${default[@]}"

sketchybar --add event aerospace_workspace_change

for sid in $(aerospace list-workspaces --all); do
  sketchybar --add item space.$sid left \
             --set space.$sid \
             background.color=$BACKGROUND_1 \
             background.corner_radius=6 \
             background.height=24 \
             background.drawing=off \
             icon.font="sketchybar-app-font:Regular:16.0" \
             label.font="AdwaitaMono Nerd Font Propo:Medium:14.0" \
             label="$sid" \
             label.padding_left=6 \
             label.padding_right=4 \
             icon.padding_left=4 \
             icon.padding_right=6 \
             drawing=off \
             updates=when_shown \
             click_script="aerospace workspace $sid" \
             script="$PLUGIN_DIR/aerospace.sh" \
             --subscribe space.$sid aerospace_workspace_change front_app_switched
done

sketchybar --add item aerospace_refresh left \
           --set aerospace_refresh drawing=off \
                                  script="$PLUGIN_DIR/aerospace.sh" \
                                  updates=on \
           --subscribe aerospace_refresh aerospace_workspace_change front_app_switched

sketchybar --add item chevron left \
           --set chevron icon=ÔÅî \
                         icon.color=$ORANGE \
                         label.drawing=off \
                         background.drawing=off

sketchybar --add item front_app left \
           --set front_app script="$PLUGIN_DIR/front_app.sh" \
                          background.color=$BACKGROUND_1 \
                          update_freq=1 \
           --subscribe front_app front_app_switched space_windows_change window_focus

sketchybar --add item clock right \
           --set clock update_freq=10 \
                      script="$PLUGIN_DIR/clock.sh" \
                      background.color=$BACKGROUND_1

sketchybar --add item volume right \
           --set volume script="$PLUGIN_DIR/volume.sh" \
                       background.color=$BACKGROUND_1 \
           --subscribe volume volume_change

sketchybar --add item brew right \
           --set brew update_freq=43200 \
                     script="$PLUGIN_DIR/brew.sh" \
                     background.color=$BACKGROUND_1

sketchybar --add item cpu right \
           --set cpu update_freq=2 \
                    script="$PLUGIN_DIR/cpu.sh" \
                    background.color=$BACKGROUND_1

sketchybar --add item ram right \
           --set ram update_freq=2 \
                    script="$PLUGIN_DIR/ram.sh" \
                    background.color=$BACKGROUND_1

sketchybar --trigger aerospace_workspace_change

sketchybar --update
